<html>
	<head>
		<script type="text/javascript" src="./forward-about-that-title.js"></script>
		<script type="text/javascript" src="./prefix-why-not-drinking.js"></script>
		<script type="text/javascript" src="./chapter-01-using-this-booklet.js"></script>
		<script type="text/javascript" src="./chapter-02-staying-away-from-the-first-drink.js"></script>
		<script type="text/javascript" src="./chapter-03-using-the-24-hour-plan.js"></script>
		<script type="text/javascript" src="./chapter-04-remembering-alcoholism-is-an-incurable-progressive-and-fatal-disease.js"></script>
		<script type="text/javascript" src="./chapter-05-live-and-let-live.js"></script>
		<script type="text/javascript" src="./chapter-06-getting-active.js"></script>
		<script type="text/javascript" src="./chapter-07-using-the-serenity-prayer.js"></script>
		<script type="text/javascript" src="./chapter-08-changing-old-routines.js"></script>
		<script type="text/javascript" src="./chapter-09-eating-or-drinking-something-usually-sweet.js"></script>
		<script type="text/javascript" src="./chapter-10-making-use-of-telephone-therapy.js"></script>
		<script type="text/javascript" src="./chapter-11-availing-yourself-of-a-sponsor.js"></script>
		<script type="text/javascript" src="./chapter-12-getting-plenty-of-rest.js"></script>
		<script type="text/javascript" src="./chapter-13-first-things-first.js"></script>
		<script type="text/javascript" src="./chapter-14-fending-off-loneliness.js"></script>
		<script type="text/javascript" src="./chapter-15-watching-out-for-anger-and-resentments.js"></script>
		<script type="text/javascript" src="./chapter-16-being-good-to-yourself.js"></script>
		<script type="text/javascript" src="./chapter-17-looking-out-for-over-elation.js"></script>
		<script type="text/javascript" src="./chapter-18-easy-does-it.js"></script>
		<script type="text/javascript" src="./chapter-19-being-grateful.js"></script>
		<script type="text/javascript" src="./chapter-20-remembering-your-last-drunk.js"></script>
		<script type="text/javascript" src="./chapter-21-avoiding-dangerous-drugs.js"></script>
		<script type="text/javascript" src="./chapter-22-eliminating-self-pity.js"></script>
		<script type="text/javascript" src="./chapter-23-seeking-professional-help.js"></script>
		<script type="text/javascript" src="./chapter-24-staying-clear-of-emotional-entanglements.js"></script>
		<script type="text/javascript" src="./chapter-25-getting-out-of-the-if-trap.js"></script>
		<script type="text/javascript" src="./chapter-26-being-wary-of-drinking-occasions.js"></script>
		<script type="text/javascript" src="./chapter-27-letting-go-of-old-ideas.js"></script>
		<script type="text/javascript" src="./chapter-28-reading-the-aa-message.js"></script>
		<script type="text/javascript" src="./chapter-29-going-to-aa-meetings.js"></script>
		<script type="text/javascript" src="./chapter-30-trying-the-12-steps.js"></script>
		<script type="text/javascript" src="./chapter-31-finding-your-own-way.js"></script>
		<script type="text/javascript" src="./the-twelve-steps.js"></script>
		<script type="text/javascript" src="./appendix.js"></script>

	    <script
		    type="text/javascript"
		    src="https://code.jquery.com/jquery-3.7.1.min.js"
		    integrity="sha384-1H217gwSVyLSIfaLxHbE7dRb3v4mYCKbpQvzx0cegeju1MVsGrX5xXxAvs/HgeFs"
		    crossorigin="anonymous"></script>

        <script
            type="text/javascript"
            src="https://code.jquery.com/ui/1.14.1/jquery-ui.min.js"
            integrity="sha384-SStJQoPipVtHHnIgUfDI+jTAbSyU+HMbhwt2XRRNpLIRFg9VguopT6Y4+cdOlkqg"
            crossorigin="anonymous"></script>

        <link
            rel="stylesheet"
            href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css"
            integrity="sha384-vIQIPaHJRqkO8xhnLxSZ0rHF6LyiWXbLF3grsa9pv9yDFyOPGrE1teHOuRNMJoZs"
            crossorigin="anonymous">

		<script type="text/javascript">
			let chapters = null;

			let currentChapterId = 0;

			$(document).ready(
				() => {
					try
					{
						$("button#information").on("click", (event) => {
							$("div#information-dialog").dialog({
								title: "Information",
								modal: true,
								width: "80%",
								height: "auto"
							});
						});

						$("body").on("click", (event) => {
							if ($(event.target).is("div#information-dialog") || $(event.target).is(".ui-widget-overlay") || $(event.target).is("div#information-dialog p")) {
								$("div#information-dialog").dialog("close");
							}
						});
						chapters = [
							forwardAboutThatTitle, prefixWhyNotDrinking, chapter01, chapter02, chapter03, chapter04, chapter05, chapter06, chapter07, chapter08, chapter09, chapter10, chapter11, chapter12, chapter13, chapter14, chapter15, chapter16, chapter17, chapter18, chapter19, chapter20, chapter21, chapter22, chapter23, chapter24, chapter25, chapter26, chapter27, chapter28, chapter29, chapter30, chapter31, theTwelveSteps, appendix
						]

						let newContent = "";

						chapters.forEach((chapter, idx) => {
							const chapterNumber = (idx < 2 || idx === chapters.length - 1) ? "&nbsp;" : (idx - 1).toString();
							newContent += `<dt>${chapterNumber}</dt><dd><a class="show-chapter" attrId="${idx}">${chapter.title}</a></dd>`;
						});

						$("div#accordion dl.toc").append(newContent);

						$("#accordion").accordion({"collapsible": true, "active": false});

						$(".show-chapter").on("click", (event) => {
							event.preventDefault();

							changeChapter(parseInt($(event.target).attr("attrId")));
						})

						$("button#prev").on("click", (event) => changeChapter(currentChapterId - 1));

						$("button#next").on("click", (event) => changeChapter(currentChapterId + 1));

						$("input#fontSizeSlider").on(
							"input",
							(event) => {
								const fontSize = parseInt($(event.target).val());

								changeFontSize(fontSize);
							}
						);

						setPreferencesOnLoad();
					} catch (error) {
						alert(error);
					}
				}
			);

			const changeFontSize = (fontSize) => {
				let newFontClass = "";

				if (fontSize < 0) {
					newFontClass = "font-minus-" + (Math.abs(fontSize) * 10) + "-percent";
				} else if (fontSize > 0) {
					newFontClass = "font-plus-" + (fontSize * 10) + "-percent";
				}

				console.log(newFontClass);

				$("div#chapter-content").attr("class", newFontClass);

				localStorage.setItem("fontClass", newFontClass);
			};

			const changeChapter = (chapterId, titleOverwrite = null) => {
				if (chapterId < 0 || chapterId >= chapters.length) {
					return;
				}

				currentChapterId = chapterId;

				$("div#chapter-content").html(chapters[chapterId].body + "<br><br><br><br><br>");

				$("div#content-container").animate({ scrollTop: 0 }, "slow");

				const title = (titleOverwrite !== null) ? titleOverwrite : chapters[chapterId].title;

				$("#accordion h3").html("≡ " + title);

				$("#accordion").accordion("option", "active", false);

				$("button#prev").css("opacity", (chapterId === 0) ? "0.2" : "1.0");

				$("button#next").css("opacity", (chapterId === chapters.length - 1) ? "0.2" : "1.0");

				localStorage.setItem("currentChapterId", chapterId);
			};

			const setPreferencesOnLoad = () => {
				const storedChapterId = localStorage.getItem("currentChapterId");

				const storedFontClass = localStorage.getItem("fontClass");

				if (storedChapterId !== null) {
					changeChapter(parseInt(storedChapterId), "Living Sober");
				} else {
					changeChapter(0, "Living Sober");
				}

				if (storedFontClass !== null) {
					$("div#chapter-content").addClass(storedFontClass);
				}
			};
		</script>
		<style type="text/css">
			#accordion-container {
				position: fixed;
				z-index: 100;
				width: 100%;
			}

			#accordion h3 {
				white-space: nowrap;
			  	overflow: hidden;
			  	text-overflow: ellipsis;
				font-size: 4em;
			}

			#accordion dl.toc {
				overflow-y: scroll;
				position: fixed;
				z-index: 100;
				top: 8.5em;
				width: 100%;
				z-index: 50;
				bottom: 0;
				overflow-y: scroll;
				padding-bottom:8em;
			}


			dl.toc dt, dl.toc dd {
				line-height: 1em;
				padding-top: .25em;
				padding-bottom: .25em;
				padding-left: 0;
				padding-right: 0;
				font-size: 3em;
				clear: none;
				float: left;
			}

			dl.toc dt {
				text-align: right;
			}

			dl.toc dt.a, dl.toc dd a {
				cursor: pointer;
			}

			dl.toc dt {
				width: 2em;
			}

			dl.toc dd {
				float: left;
				width: calc(100% - 3em);
			}

			div#navigation {
				position: fixed;
				height: 3.5em;
				top: 9.5em;
				width: 100%;
				z-index: 50;
			}

			button#prev, button#next {
				position: absolute;
				padding-left: 2em;
				padding-right: 2em;
				top: .25em;
				height: 2.5em;
				max-width: 49%;
				width:10em;
				font-size: 2em;
			}

			button#prev {
				left:0%;
			}

			button#next {
				right: 1%;
			}

			div#content-container {
				position: fixed;
				top: 15em;
				overflow-y: scroll;
				left: 1em;
				right: 1em;
				bottom: 0;
			}
			div#chapter-content {
				left: 1em;
				right: 1em;
				font-family: Verdana;
				font-size: 1.25em;
				text-align: justify;
				overflow-x: scroll;
			}

			div#chapter-content.font-minus-100-percent {
				font-size: calc(1.25em * 0.01);
			}

			div#chapter-content.font-minus-90-percent {
				font-size: calc(1.25em * 0.10);
			}

			div#chapter-content.font-minus-80-percent {
				font-size: calc(1.25em * 0.20);
			}

			div#chapter-content.font-minus-70-percent {
				font-size: calc(1.25em * 0.30);
			}

			div#chapter-content.font-minus-60-percent {
				font-size: calc(1.25em * 0.40);
			}

			div#chapter-content.font-minus-50-percent {
				font-size: calc(1.25em * 0.50);
			}

			div#chapter-content.font-minus-40-percent {
				font-size: calc(1.25em * 0.60);
			}

			div#chapter-content.font-minus-30-percent {
				font-size: calc(1.25em * 0.70);
			}

			div#chapter-content.font-minus-20-percent {
				font-size: calc(1.25em * 0.80);
			}

			div#chapter-content.font-minus-10-percent {
				font-size: calc(1.25em * 0.9);
			}

			div#chapter-content.font-plus-10-percent {
				font-size: calc(1.25em * 1.10);
			}

			div#chapter-content.font-plus-20-percent {
				font-size: calc(1.25em * 1.20);
			}

			div#chapter-content.font-plus-30-percent {
				font-size: calc(1.25em * 1.30);
			}

			div#chapter-content.font-plus-40-percent {
				font-size: calc(1.25em * 1.40);
			}

			div#chapter-content.font-plus-50-percent {
				font-size: calc(1.25em * 1.50);
			}

			div#chapter-content.font-plus-60-percent {
				font-size: calc(1.25em * 1.60);
			}

			div#chapter-content.font-plus-70-percent {
				font-size: calc(1.25em * 1.70);
			}

			div#chapter-content.font-plus-80-percent {
				font-size: calc(1.25em * 1.80);
			}

			div#chapter-content.font-plus-90-percent {
				font-size: calc(1.25em * 1.90);
			}

			div#chapter-content.font-plus-100-percent {
				font-size: calc(1.25em * 2.00);
			}

			div#chapter-content ul {
				text-align: left;
			}

			button#information {
				position: fixed;
				bottom: .5em;
				right: .5em;
				font-size: 3em;
				z-index: 100;
				background-color: transparent;
				border: none;
				z-index: 1000;
			}

			div#information-dialog {
				display: none;
				font-size: .8em;
			}

			div#information-dialog p {
				padding-left: 10%;
				padding-right: 10%;
				text-align: justify;
			}

			div#information-dialog p#slider-container {
				text-align: center;
				padding-right: 0;
				padding-left: 0;
			}

			footer#fade-footer {
				position:fixed;
				height: 5em;
				left: 0;
				right: 0;
				bottom: 0;
				text-align: center;
				font-size: 1.5em;
				background-image: linear-gradient(to bottom, rgba(255,0,0,0), rgba(0,0,0, .8));
				z-index: 98;
			}

			div.ui-dialog-titlebar {
				font-size: 2em;
			}

			div.ui-dialog-content {
				font-size: 1.5em;
			}

			span.ui-button-icon, button.ui-button {
				zoom: 1.5;
			}

			input#fontSizeSlider {
				-webkit-appearance: none;
				width: 100%;
				height: 2em;
				border-radius: 5px;
				background: #d3d3d3;
				outline: none;
				opacity: 0.9;
				-webkit-transition: .2s;
				transition: opacity .2s;
			}

			input#fontSizeSlider::-webkit-slider-thumb {
				-webkit-appearance: none;
				width: 5em;
				height: 3em;
				border-radius: none;
				background: #2244CC;
				cursor: pointer;
			}

			.slider::-moz-range-thumb {
				width: 5em;
				height: 4em;
				border-radius: none;
				background: #2244CC;
				cursor: pointer;
			}
		</style>
	</head>

	<body>
		<div id="accordion-container">
			<div id="accordion">
			  <h3>CHAPTERS</h3>
			  <dl class="toc"></dl>
			</div>
		</div>
		<div id="navigation">
			<button id="prev">◀️&nbsp;&nbsp;Prev</button>
			<button id="next">Next&nbsp;&nbsp;▶️</button>
		</div>
		<div id="content-container">
			<div id="chapter-content" class=""></div>
		</div>
		<button id="information">ℹ️</button>
		<div id="information-dialog">
			<p>This digital version of the 'Living Sober' booklet contains practical advice for those in recovery from alcoholism. Use the navigation buttons to explore the chapters.</p>
			<p>This content is shared pursuant to section 107 of the Copyright Act 1976. Digital and printed copies of Living Sober can be purchased from the Alcoholics Anonymous website:</p>
			<p style="text-align: center;"><a target="_blank" href="https://www.aa.org/living-sober-book">Living Sober</a></p>
			<p>Copyright © 2024 Alcoholics Anonymous World Services, Inc.</p>
			<p style="text-align: center;"><img src="./qr-code.png" style="height: 200px"/></p>
			<p><hr></p>
			<p id="slider-container"><input type="range" min="-5" max="10" class="slider" id="fontSizeSlider"></p>
		</div>
		<footer id="fade-footer">
		</footer>
	</body>
</html>
